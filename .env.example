# Server Configuration
PORT=5114
NODE_ENV=development
FRONTEND_URL=http://100.83.153.43:3112

# Database
DATABASE_URL=postgres://postgres:postgres@localhost:5544/ai_trader

# Redis
REDIS_URL=redis://localhost:6491

# JWT
JWT_SECRET=replace_with_secure_secret_key
# Control plane auth token (required for any mutating action)
CONTROL_PLANE_TOKEN=replace_with_long_random_secret

# Coinbase API (Required for Market Data & Execution)
COINBASE_API_KEY=your_coinbase_api_key
COINBASE_API_SECRET=your_coinbase_api_secret
COINBASE_PASSPHRASE=your_coinbase_passphrase
COINBASE_SANDBOX=true
# Coinbase market data feed (Advanced Trade WS default)
COINBASE_WS_URL=wss://advanced-trade-ws.coinbase.com

# Trading Safety Latches
# Keep false for dry-run validation even when UI mode is LIVE.
LIVE_ORDER_POSTING_ENABLED=false
# Legacy alias still respected by backend executor.
LIVE_TRADING_ENABLED=false
# Local path for persisted strategy trade dataset used by validation harness.
STRATEGY_TRADE_LOG_PATH=logs/strategy_trades.csv
# Local path for persisted rejected-signal events (intelligence/model/preflight/live/settlement).
REJECTED_SIGNAL_LOG_PATH=logs/rejected_signals.jsonl
# If true, reset validation dataset whenever simulation bankroll/PnL is reset.
RESET_VALIDATION_TRADES_ON_SIM_RESET=true

# Paper Simulation Cost Model (basis points per side)
SIM_FEE_BPS_PER_SIDE=10
SIM_SLIPPAGE_BPS_PER_SIDE=15

# LLM Providers (Required for Intelligence Layer)
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...

# Polymarket (Optional for Arbitrage)
POLYMARKET_API_KEY=...
POLYMARKET_JIGSTACK_API_KEY=...
POLYMARKET_CLOB_HOST=https://clob.polymarket.com
POLY_CHAIN_ID=137
POLY_SIGNATURE_TYPE=1
# Reuse same keys for Rust scanner + backend preflight signer.
PRIVATE_KEY=0x...
PROXY_WALLET_ADDRESS=0x...
POLY_PREFLIGHT_MIN_INTERVAL_MS=1200
POLY_PREFLIGHT_RETRY_ON_ERROR=false
# Backend live-post safety ceilings (USD notional)
POLY_MAX_ORDER_NOTIONAL_USD=500
POLY_MAX_SIGNAL_NOTIONAL_USD=2000
POLY_EXECUTION_MIN_INTERVAL_MS=2500
# Prefer non-resting order types for latency/arbitrage workflows.
POLY_LIVE_ORDER_TYPE=FOK
# Settlement/redeem worker (mainnet defaults from Polymarket docs)
POLY_AUTO_REDEEM_ENABLED=false
POLY_SETTLEMENT_POLL_MS=30000
POLY_REDEEM_RETRY_COOLDOWN_MS=60000
POLY_MIN_REDEEMABLE_SHARES=0.01
POLY_SETTLEMENT_STALE_MS=3600000
POLY_RPC_URL=https://polygon-rpc.com
POLY_CONDITIONAL_TOKENS_ADDRESS=0x4D97DCd97eC945f40cF65F87097ACe5EA0476045
POLY_COLLATERAL_TOKEN_ADDRESS=0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174
# Optional: reset paper bankroll to default on backend boot.
SIM_RESET_ON_BOOT=false
# Optional: strategy variant tag for research comparisons.
STRATEGY_VARIANT=baseline
# Live execution intelligence gate
INTELLIGENCE_GATE_ENABLED=true
INTELLIGENCE_GATE_MAX_STALENESS_MS=3000
INTELLIGENCE_GATE_MIN_MARGIN=0
INTELLIGENCE_GATE_CONFIRMATION_WINDOW_MS=5000
INTELLIGENCE_GATE_REQUIRE_PEER_CONFIRMATION=true
INTELLIGENCE_GATE_STRONG_MARGIN=0.01

# Concentration + utilization controls (paper ledger)
SIM_STRATEGY_CONCENTRATION_CAP_PCT=0.35
SIM_FAMILY_CONCENTRATION_CAP_PCT=0.60
SIM_GLOBAL_UTILIZATION_CAP_PCT=0.90

# Phase 2/3 model controls (advisory + paper gating)
MODEL_PROBABILITY_GATE_ENABLED=true
MODEL_PROBABILITY_GATE_ENFORCE_PAPER=true
MODEL_PROBABILITY_GATE_ENFORCE_LIVE=false
MODEL_PROBABILITY_GATE_MIN_PROB=0.55
MODEL_PROBABILITY_GATE_REQUIRE_MODEL=false
MODEL_PROBABILITY_GATE_DISABLE_ON_DRIFT=true
MODEL_PROBABILITY_GATE_DRIFT_DISABLE_MS=900000
MODEL_PROBABILITY_GATE_MAX_STALENESS_MS=5000
MODEL_PROBABILITY_GATE_TUNER_ENABLED=true
MODEL_PROBABILITY_GATE_TUNER_ADVISORY_ONLY=false
MODEL_PROBABILITY_GATE_TUNER_INTERVAL_MS=120000
MODEL_PROBABILITY_GATE_TUNER_LOOKBACK_MS=21600000
MODEL_PROBABILITY_GATE_COUNTERFACTUAL_WINDOW_MS=600000
MODEL_PROBABILITY_GATE_TUNER_MIN_SAMPLES=60
MODEL_PROBABILITY_GATE_TUNER_STEP=0.01
MODEL_PROBABILITY_GATE_TUNER_MAX_DRIFT=0.08
MODEL_PREDICTION_TRACE_MAX=100000

# In-process training cadence (no Python dependency in backend container)
MODEL_TRAINER_ENABLED=true
MODEL_TRAINER_INTERVAL_MS=120000
MODEL_TRAINER_MIN_LABELED_ROWS=80
MODEL_TRAINER_MIN_NEW_LABELS=8
MODEL_TRAINER_SPLITS=5
MODEL_TRAINER_PURGE_ROWS=24
MODEL_TRAINER_EMBARGO_ROWS=24

# ML-service supervised ensemble signal (XGBoost + sklearn)
ML_SIGNAL_LABEL_HORIZON_MS=90000
ML_SIGNAL_LABEL_NEUTRAL_BAND=0.0005
ML_SIGNAL_MIN_TRAIN_SAMPLES=400
ML_SIGNAL_MAX_TRAIN_SAMPLES=5000
ML_SIGNAL_RETRAIN_EVERY_SAMPLES=64
ML_SIGNAL_MIN_RETRAIN_INTERVAL_MS=45000
ML_SIGNAL_MIN_CLASS_SAMPLES=40
ML_SIGNAL_EVAL_MIN_SAMPLES=80

# BTC_5M model-signal gate (additional edge filter)
BTC_5M_MODEL_SIGNAL_FILTER_ENABLED=true
BTC_5M_MODEL_SIGNAL_CONFIDENCE_MIN=0.22
BTC_5M_MODEL_SIGNAL_PENALTY_BPS=90
BTC_5M_MODEL_SIGNAL_BONUS_BPS=35
BTC_5M_MODEL_SIGNAL_MIN_SAMPLES=240
BTC_5M_MODEL_SIGNAL_MIN_AUC=0.52
BTC_5M_MODEL_SIGNAL_MAX_LOGLOSS=0.72
BTC_5M_MODEL_SIGNAL_MAX_BRIER=0.28

# Portfolio meta-allocator + execution preparation controls
META_ALLOCATOR_ENABLED=true
META_ALLOCATOR_META_BLEND=0.65
META_ALLOCATOR_MIN_OVERLAY=0.55
META_ALLOCATOR_MAX_OVERLAY=1.45
META_ALLOCATOR_FAMILY_CONCENTRATION_SOFT_CAP=0.45
META_ALLOCATOR_COST_DRAG_PENALTY_BPS=25
EXECUTION_SHORTFALL_OPTIMIZER_ENABLED=true
EXECUTION_SHORTFALL_TARGET_RETAIN_BPS=18
EXECUTION_SHORTFALL_MIN_RETAIN_BPS=2
EXECUTION_SHORTFALL_MAX_SIZE_REDUCTION_PCT=0.75
EXECUTION_SHORTFALL_MIN_SIGNAL_NOTIONAL_USD=10
EXECUTION_NETTING_ENABLED=true
EXECUTION_NETTING_TTL_MS=1200000
EXECUTION_NETTING_MARKET_CAP_USD=1200
EXECUTION_NETTING_OPPOSING_BLOCK_RATIO=0.85

# Conservative rollout helpers (see config/live_canary_baseline.env)
SOAK_MIN_PREFLIGHT_SAMPLES=20
SOAK_MIN_PREFLIGHT_PASS_RATE_PCT=96
SOAK_MAX_SHORTFALL_BLOCK_RATE_PCT=18
SOAK_MAX_NETTING_BLOCK_RATE_PCT=12
SOAK_MIN_EDGE_CAPTURE_RATIO=0.55
